---
title: "32061412_Assignment2"
author: "HongYi"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: show
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  markdown: 
    wrap: sentence
---

## Libraries loading

```{r}
library(tidyverse)
library(lubridate)
library(stringr)
```

## Data exploration

```{r}
# read the news data
news <- read_csv("ireland_news.csv")
```

```{r}
head(news)
```

```{r}
glimpse(news)
```

## Question 1

What are the earliest and latest articles from Irish Independent, irrespective of headline category?
Please also sort the data according to the column publish_date in an ascending manner and display the last 5 records of the data.

### Answer

-   only publish_date and headline category are the selected columns because we already know the data is from Irish Independent and headline category is irrelevant

-   before sorting, filter out the NA publish_date column

-   arrange the data based on the publish_date in date type

```{r}
# get Irish Independent's articles only
news_irish <- news %>%
  filter(news_provider == "Irish Independent") %>%
  select(publish_date, headline_text)

# filter out NA date, change the data type of date, and sort asc
news_irish <- news_irish %>%
  filter(!is.na(publish_date)) %>%
  mutate(publish_date = dmy(publish_date)) %>%
  arrange(publish_date)
  
# view data in ascending order and view earliest records
news_irish

# display last 5 records(5 latest data)
tail(news_irish, 5)
```

## Question 2

How many unique headline_category values are there in the data file?
Please consider variations (e.g.: capitalisation, potential inconsistencies) of the headline_category values, when counting them.

How many news category articles contain either the keyword, "Ireland", "Irish", "US", or "USA" along with year digits from 2000 to 2024 in headline_text?
For example, you need to search and count articles containing both “Ireland” and the year digits, or containing both “Irish” and the year digits, and so on.

### Answer

During data exploration, headline category separated by "\_" instead of "." is found and contains NA data.

```{r}
capital_exist <- news %>% 
  filter(str_detect(headline_category, "[A-Z]+"))

underscore_exist <- news %>%
  filter(str_detect(headline_category, "_")) 

na_exist <- news %>%
  filter(is.na(headline_category))

capital_exist
underscore_exist
na_exist
```

Therefore, do counting after replacing "\_" with "." , lower case them and filter out the NA headline_category.

```{r}

uniq_category <- news %>%
  # transform headline_category column to lower case
  mutate(headline_category = tolower(headline_category)) %>%
  # replace all underscores to dots in headline_category column
  mutate(headline_category = str_replace_all(headline_category,"_",".")) %>%
  # filter na data
  filter(!is.na(headline_category)) %>%
  # get unique rows only
  distinct(headline_category)

nrow(uniq_category)
```

Filter rows that are from "news" category and contain "Ireland", "Irish", "US", or "USA" and 2000 to 2024 in headline_text

```{r}
news_categories <- news %>%
  filter(headline_category == "news") %>%
  filter(str_detect(headline_text, "US|USA|Irish|Ireland")) %>%
  filter(str_detect(headline_text, "2020|2021|2022|2023|2024"))

nrow(news_categories)
```

## Question 3

Please display the top 10 headline categories with the largest number of articles published on Monday throughout the years.
Then, draw a chart showing the total number of articles for the top 10 headline categories (as identified previously) for each year.
What can you observe?
Please discuss the chart and your findings.

### Answer

-   filter such that it is Monday, non-NA(like Q2),

-   transform headline_category, lower case and inconsistency such as "\_" (like Q2)

-   group by headline_category

-   calculate count for each group

-   descending order

```{r}
top_10 <- news %>%
  # Monday only
  filter(str_detect(publish_date, "Monday")) %>%
  # filter NA headline category
  filter(!is.na(headline_category)) %>%
  # transform headline_category column to lower case
  mutate(headline_category = tolower(headline_category)) %>%
  # replace all underscores to dots in headline_category column
  mutate(headline_category = str_replace_all(headline_category,"_",".")) %>%
  # group by headline category to get the count for each group
  group_by(headline_category) %>%
  # display headline_category with respective count
  summarise(count = n_distinct(headline_text, na.rm = TRUE)) %>%
  ungroup() %>%
  # arrange in desc order
  arrange(desc(count)) %>%
  head(10)

top_10
```

For second part of the Question 3, additionally,

-   filter such that it has date and not NA

```{=html}
<!-- -->
```
-   filter such that it is from the top 10 headline_category above

-   transform date to year into another column

-   group by both headline_category and year

```{r}
top_10_over_years <- news %>%
  # filter so that date is not unavailable
  filter(!is.na(publish_date)) %>%
  # filter the top 10 headline_category
  filter(headline_category %in% top_10$headline_category) %>%
  mutate(headline_category = tolower(headline_category)) %>%
  mutate(headline_category = str_replace_all(headline_category,"_",".")) %>%
  # change to Date type
  mutate(publish_date = dmy(publish_date)) %>%
  # get year from Date and put into 'year' column
  mutate(year = format(publish_date, "%Y")) %>%
  # additionally, group by year
  group_by(headline_category, year) %>%
  summarise(count = n_distinct(headline_text, na.rm = TRUE)) %>%
  ungroup() %>%
  arrange(desc(count))

# show top 10 each year
top_10_over_years
```

Plot line graph

-   The x and y axis are flipped because if x-axis is 'Year', the range of the 'Year' is too large and causes the number to be overlapped and hard to see

```{r}
# plot 
top_10_over_years %>%
  ggplot(aes(x = year, y = count, group = headline_category, color=headline_category)) +
  geom_line(size=1) +
  xlab("Year") +
  ylab("Count") +
  labs(title="Total number of articles for the top 10 headline categories for each year", subtitle = "News has much larger number of articles than other categories before 2013") + 
  coord_flip()
```

#### Findings

-   It can be seen as 3 levels number of articles

    1.  News has much larger number of articles than others before 2013
    2.  Sport and Business maintained roughly between 5000 to 10000 articles before 2010(inclusive) and before 2012(inclusive) respectively
    3.  All the other headline categories have below 5000 articles over the years

-   There are 3 obvious lines that only have articles since 1999(sport.rugby, sport.soccer) and 2008(news.law)

## Question 4

Compute the total number of articles for each headline category and news provider.
Then, use a single R function/command to display the statistical information, i.e., Min, Max, and Mean, of the total number of articles (as computed previously) for each news provider.
Note: You can use multiple functions/commands to get the desired pre-processed data table, but when you compute and display the statistical information, you need to use a single R function/command.

```{r}
articles_cate_prov <- news %>%
  # filter out NA category and provider
  filter(!is.na(headline_category) & !is.na(news_provider)) %>%
  # for each headline category and news provider
  group_by(headline_category, news_provider) %>%
  # calculate count
  summarise(count = n_distinct(headline_text, na.rm = TRUE)) %>%
  ungroup()
```

```{r}
# display statistical info using summary()
articles_cate_prov <- articles_cate_prov %>% summary()
articles_cate_prov
```

## Question 5

Please compute the total number of articles for each headline category, news provider, and the day of the week.
Then, compute the average number of articles for each news provider and the day of the week, based on the total number of articles computed previously.
After that, please display the day of the week with the highest average number of articles for each provider.
The output data should be structured in the following format.

## Question 6

## Question 7

## Question 8
